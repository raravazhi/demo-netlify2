<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.93.0" />
<meta name="robots" content="index, follow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/vmware.github.io\/ml-ops-platform-for-vsphere\/"
      },
      "articleSection" : "docs",
      "name" : "",
      "headline" : "",
      "description" : "Lab 7: Kubeflow Pipeline Install Kubeflow Pipeline Package !pip install kfp --upgrade --user --quiet # confirm the kfp sdk ! pip show kfp Example 2: G-Research Crypto Forecasting In this example, we would build Kubeflow Pipeline directly from the notebook, without using Docker to build images first.\nWe assume you have already finished, or at least gone through, Example 1. If not, we recommend you to at least quickly go through Example 1, as the model in Example 1 is easier to understand and some concept explanations are discussed more in details.",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/vmware.github.io\/ml-ops-platform-for-vsphere\/docs\/kubeflow-tutorial\/lab5_pipeline_complete\/markdowns\/example2_gresearch\/",
      "wordCount" : "2781",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/ml-ops-platform-for-vsphere/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/ml-ops-platform-for-vsphere/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/ml-ops-platform-for-vsphere/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/ml-ops-platform-for-vsphere/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/ml-ops-platform-for-vsphere/favicons/manifest.json">
<meta name="msapplication-config" content="/ml-ops-platform-for-vsphere/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>Kubeflow on vSphere</title>
<meta name="description" content="Lab 7: Kubeflow Pipeline
Install Kubeflow Pipeline Package
!pip install kfp --upgrade --user --quiet
# confirm the kfp sdk
! pip show kfp
Example 2: â€¦">
<meta property="og:title" content="" />
<meta property="og:description" content="Lab 7: Kubeflow Pipeline Install Kubeflow Pipeline Package !pip install kfp --upgrade --user --quiet # confirm the kfp sdk ! pip show kfp Example 2: G-Research Crypto Forecasting In this example, we would build Kubeflow Pipeline directly from the notebook, without using Docker to build images first.
We assume you have already finished, or at least gone through, Example 1. If not, we recommend you to at least quickly go through Example 1, as the model in Example 1 is easier to understand and some concept explanations are discussed more in details." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vmware.github.io/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab5_pipeline_complete/markdowns/example2_gresearch/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2022-11-02T15:23:26+08:00" /><meta property="og:site_name" content="Kubeflow on vSphere" />

<meta itemprop="name" content="">
<meta itemprop="description" content="Lab 7: Kubeflow Pipeline Install Kubeflow Pipeline Package !pip install kfp --upgrade --user --quiet # confirm the kfp sdk ! pip show kfp Example 2: G-Research Crypto Forecasting In this example, we would build Kubeflow Pipeline directly from the notebook, without using Docker to build images first.
We assume you have already finished, or at least gone through, Example 1. If not, we recommend you to at least quickly go through Example 1, as the model in Example 1 is easier to understand and some concept explanations are discussed more in details.">
<meta itemprop="dateModified" content="2022-11-02T15:23:26+08:00" />
<meta itemprop="wordCount" content="2781">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Lab 7: Kubeflow Pipeline Install Kubeflow Pipeline Package !pip install kfp --upgrade --user --quiet # confirm the kfp sdk ! pip show kfp Example 2: G-Research Crypto Forecasting In this example, we would build Kubeflow Pipeline directly from the notebook, without using Docker to build images first.
We assume you have already finished, or at least gone through, Example 1. If not, we recommend you to at least quickly go through Example 1, as the model in Example 1 is easier to understand and some concept explanations are discussed more in details."/>




<link rel="preload" href="/ml-ops-platform-for-vsphere/scss/main.min.cfd7574257326fddbc6f33f260c0bda4c6d74394ebf2531282625a18d0a19e75.css" as="style">
<link href="/ml-ops-platform-for-vsphere/scss/main.min.cfd7574257326fddbc6f33f260c0bda4c6d74394ebf2531282625a18d0a19e75.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

    
    <link href="/ml-ops-platform-for-vsphere/css/syntax.min.css" rel="stylesheet">

    
    <link href="/ml-ops-platform-for-vsphere/css/copy-code-button.min.css" rel="stylesheet">


  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/ml-ops-platform-for-vsphere/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">Kubeflow on vSphere</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/ml-ops-platform-for-vsphere/docs/" ><i class='fas fa-book pr-2'></i><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/vmware/ml-ops-platform-for-vsphere" target="_blank" ><i class='fab fa-github pr-2'></i><span>GitHub</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://vmware.github.io/ml-ops-platform-for-vsphere/docs">v1.6</a>
	
	<a class="dropdown-item" href="https://core.vmware.com/aiml-solutions">v1.5</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-ml-ops-platform-for-vspheredocs-li">
  <a href="/ml-ops-platform-for-vsphere/docs/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-ml-ops-platform-for-vspheredocs"><span class="">Documentation</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsabout-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsabout-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsabout-check"><a href="/ml-ops-platform-for-vsphere/docs/about/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsabout"><span class="">About</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-ml-ops-platform-for-vspheredocsdeployment-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeployment-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeployment-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-ml-ops-platform-for-vspheredocsdeployment"><span class="">Deployment</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsdeploymentprerequisites-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeploymentprerequisites-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeploymentprerequisites-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/prerequisites/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsdeploymentprerequisites"><span class="">Prerequisites</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsdeploymentnamespace-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeploymentnamespace-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeploymentnamespace-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/namespace/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsdeploymentnamespace"><span class="">Create and configure a vSphere Namespace</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsdeploymentcluster-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeploymentcluster-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeploymentcluster-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/cluster/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsdeploymentcluster"><span class="">Create a Tanzu Kubernetes Cluster</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsdeploymentcarvel-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeploymentcarvel-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeploymentcarvel-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/carvel/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsdeploymentcarvel"><span class="">Deploy Kubeflow</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshooting-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshooting-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshooting-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/troubleshooting/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshooting"><span class="">Trouble Shooting</span></a></label>
  
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingproxy-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingproxy-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingproxy-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/troubleshooting/proxy/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingproxy"><span class="">Configure a proxy</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingapp-platform-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingapp-platform-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingapp-platform-check"><a href="/ml-ops-platform-for-vsphere/docs/deployment/troubleshooting/app-platform/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsdeploymenttroubleshootingapp-platform"><span class="">Install Kapp-controller</span></a></label>
  
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-ml-ops-platform-for-vspheredocskubeflow-tutorial-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutorial-check" checked/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutorial-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-ml-ops-platform-for-vspheredocskubeflow-tutorial"><span class="">Kubeflow Tutorial</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab1-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab1-check"/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab1-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab1/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab1"><span class="">Lab1 Getting Started</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab2-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab2-check"/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab2-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab2/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab2"><span class="">Lab2 Notebooks</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab3-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab3-check"/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab3-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab3/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab3"><span class="">Lab3 PyTorch Training (PyTorchJob)</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab4-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab4-check"/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab4-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab4/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab4"><span class="">lab4 Model Serving</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipelinelab_pipeline-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipelinelab_pipeline-check"/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipelinelab_pipeline-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab5_pipeline/lab_pipeline/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipelinelab_pipeline"><span class="">Lab5 Pipeline</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample1_facialkeypoint-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample1_facialkeypoint-check"/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample1_facialkeypoint-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab5_pipeline_complete/markdowns/example1_facialkeypoint/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample1_facialkeypoint"><span class=""></span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample2_gresearch-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample2_gresearch-check" checked/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample2_gresearch-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab5_pipeline_complete/markdowns/example2_gresearch/" class="align-left pl-0  active td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completemarkdownsexample2_gresearch"><span class="td-sidebar-nav-active-item"></span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completereadme-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completereadme-check"/>
  <label for="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completereadme-check"><a href="/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab5_pipeline_complete/readme/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocskubeflow-tutoriallab5_pipeline_completereadme"><span class=""></span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-ml-ops-platform-for-vspheredocsvmware-product-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsvmware-product-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsvmware-product-check"><a href="/ml-ops-platform-for-vsphere/docs/vmware-product/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-ml-ops-platform-for-vspheredocsvmware-product"><span class="">Integration with VMware</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-ml-ops-platform-for-vspheredocsvmware-productbitfusion-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsvmware-productbitfusion-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsvmware-productbitfusion-check"><a href="/ml-ops-platform-for-vsphere/docs/vmware-product/bitfusion/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-ml-ops-platform-for-vspheredocsvmware-productbitfusion"><span class="">with Bitfusion</span></a></label>
  
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-ml-ops-platform-for-vspheredocsvmware-productbitfusionbitfusion-li">
  <input type="checkbox" id="m-ml-ops-platform-for-vspheredocsvmware-productbitfusionbitfusion-check"/>
  <label for="m-ml-ops-platform-for-vspheredocsvmware-productbitfusionbitfusion-check"><a href="/ml-ops-platform-for-vsphere/docs/vmware-product/bitfusion/bitfusion/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-ml-ops-platform-for-vspheredocsvmware-productbitfusionbitfusion"><span class="">Bitfusion</span></a></label>
  
</li>
  </ul>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href="https://github.com/vmware/ml-ops-platform-for-vsphere//tree/main/website/content/en/docs/kubeflow-tutorial/lab5_pipeline_complete/markdowns/example2_gResearch.md" class="td-page-meta--view" target="_blank" rel="noopener"><i class="fa fa-file-alt fa-fw"></i> View page source</a>
  <a href="https://github.com/vmware/ml-ops-platform-for-vsphere//edit/main/website/content/en/docs/kubeflow-tutorial/lab5_pipeline_complete/markdowns/example2_gResearch.md" class="td-page-meta--edit" target="_blank" rel="noopener"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
  <a href="https://github.com/vmware/ml-ops-platform-for-vsphere//new/main/website/content/en/docs/kubeflow-tutorial/lab5_pipeline_complete/markdowns/example2_gResearch.md?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child" target="_blank" rel="noopener"><i class="fa fa-edit fa-fw"></i> Create child page</a>
  <a href="https://github.com/vmware/ml-ops-platform-for-vsphere//issues/new?title=" class="td-page-meta--issue" target="_blank" rel="noopener"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
  <a href="https://github.com/vmware/ml-ops-platform-for-vsphere/issues/new" class="td-page-meta--project-issue" target="_blank" rel="noopener"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
  
</div>

            


<div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#install-kubeflow-pipeline-package">Install Kubeflow Pipeline Package</a></li>
      </ul>
    </li>
    <li><a href="#example-2-g-research-crypto-forecasting">Example 2: G-Research Crypto Forecasting</a>
      <ul>
        <li><a href="#about-this-model">About this Model</a></li>
        <li><a href="#import-packages">Import Packages</a></li>
        <li><a href="#design-pipeline">Design Pipeline</a></li>
        <li><a href="#create-pipeline-components">Create Pipeline Components</a></li>
        <li><a href="#build-pipeline">Build Pipeline</a></li>
        <li><a href="#run-pipeline">Run Pipeline</a></li>
      </ul>
    </li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
  </ul>
</nav></div>



            

	
		



  
  

	
		



  
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="https://vmware.github.io/ml-ops-platform-for-vsphere/docs/">Documentation</a>
  </li>
  <li class="breadcrumb-item">
    <a href="https://vmware.github.io/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/">Kubeflow Tutorial</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="https://vmware.github.io/ml-ops-platform-for-vsphere/docs/kubeflow-tutorial/lab5_pipeline_complete/markdowns/example2_gresearch/"></a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1></h1>
	
	<header class="article-meta">
		

  
    


  
    


  

		
	</header>    
	<h1 id="lab-7-kubeflow-pipeline">Lab 7: Kubeflow Pipeline</h1>
<h3 id="install-kubeflow-pipeline-package">Install Kubeflow Pipeline Package</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">kfp</span> <span class="o">--</span><span class="n">upgrade</span> <span class="o">--</span><span class="n">user</span> <span class="o">--</span><span class="n">quiet</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># confirm the kfp sdk</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span> <span class="n">pip</span> <span class="n">show</span> <span class="n">kfp</span>
</span></span></code></pre></div><h2 id="example-2-g-research-crypto-forecasting">Example 2: G-Research Crypto Forecasting</h2>
<p>In this example, we would build Kubeflow Pipeline directly from the <em><strong>notebook</strong></em>, without using Docker to build images first.</p>
<p><em>We assume you have already finished, or at least gone through, Example 1. If not, we recommend you to at least quickly go through Example 1, as the model in Example 1 is easier to understand and some concept explanations are discussed more in details.</em></p>
<h3 id="about-this-model">About this Model</h3>
<p>This model comes from Kaggle Competition. Over $40 billion worth of cryptocurrencies are traded every day. The objective of this task is to correctly forecast short term returns in 14 popular cryptocurrencies. <a href="https://www.gresearch.co.uk/">G-Research</a> is Europeâ€™s leading quantitative finance research firm, and partered with <a href="https://www.cambridgespark.com">Cambridge Spark</a> for this Kaggle Competition.</p>
<p>The dataset this model would use contains information on historic trades for several cryptoassets, such as Bitcoin and Ethereum. Dataset would be downloaded from Kaggle.</p>
<p>More details about this model and dataset itself or Kaggle Competition can be found <a href="https://www.kaggle.com/competitions/g-research-crypto-forecasting/overview">here</a>.</p>
<h3 id="import-packages">Import Packages</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">pip</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.components</span> <span class="k">as</span> <span class="nn">comp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">kfp.dsl</span> <span class="k">as</span> <span class="nn">dsl</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">kfp.components</span> <span class="kn">import</span> <span class="n">OutputPath</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
</span></span></code></pre></div><h3 id="design-pipeline">Design Pipeline</h3>
<p>Again, we design our pipeline component by component. We build our components this time as Python function-based components. The Kubeflow Pipelines SDK makes it easier to build lightweight Python function-based components by saving the effort of creating a component specification. Python function-based components make it easier to build pipeline components by building the component specification for you. Python function-based components also handle the complexity of passing inputs into your component and passing your functionâ€™s outputs back to your pipeline.</p>
<p>Let&rsquo;s walk through this concrete example to understand above ideas better.</p>
<p>Note that the overall workflow follows from original model itself. So please do not freak out when you see long, heavy code cells.</p>
<p>Basically, the following modifications were required to the original function.</p>
<ul>
<li>The import statements were moved inside of the function. Python function-based components require standalone Python functions. This means that any required import statements must be defined within the function, and any helper functions must be defined within the function.</li>
<li>The functionâ€™s arguments all include <code>data_path</code> which specifies the location for data storage, and also accessing. This lets Kubeflow Pipelines know the where to extract the data in zipped tar file into, where your function stores the processed data or model, and where to access it and use it as inputs for components.</li>
</ul>
<h4 id="download-data">Download Data</h4>
<p>We start from data downloading. As specified at the beginning of this example, the datasets we would use come from Kaggle competition.</p>
<p><strong>Setup Kaggle</strong></p>
<p>To enable our pipeline to download datasets from Kaggle while running, you need to first do some setups on Kaggle.</p>
<ol>
<li>Go to this <a href="https://www.kaggle.com/">Kaggle</a>. Login to your account, and register an account if you do not have one.</li>
<li>Click on your user profile picture, and go to &ldquo;Account&rdquo;.</li>
<li>On your profile, Account section, scroll down and find &ldquo;API&rdquo; section. Click on &ldquo;Create New API Token&rdquo; button.</li>
<li>Wait for a short while, a file called <code>kaggle.json</code> should be downloaded on your local computer. Open that json file. The <code>api-key</code> and <code>username</code> are the ones we would need.</li>
<li>Keep your Kaggle account login. Go to <a href="https://www.kaggle.com/competitions/g-research-crypto-forecasting/rules">G-Research Crypto Forecasting Rules</a>, and click to accept those rules.</li>
</ol>
<p>OK, you&rsquo;re all set! The above process is completely free so there is no need to worry. For now, you need to do above works to enable our pipeline to downaload data from Kaggle. In the future, we are planning to store those datasets somewhere that would be more convinient for your to downaload from.</p>
<p>And we are now ready for our Download Data component design.</p>
<p>Below is our Python-function-based Download Data component. It needs your Kaggle username and key. For convinience, you may directly copy and paste them.</p>
<p>(But if you do not want them to be exposed directly to Kubeflow Pipeline, you may need to spend some time to create a Kubernetes secret to handle the sensitive API credentials. There are many, including the official one, <a href="https://kubernetes.io/docs/concepts/configuration/secret/">tutorials</a> online, and we also provide you some sample codes in following cell. Detailed tutorial on this would come soon.)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># download data step</span>
</span></span><span class="line"><span class="cl"><span class="c1"># input dataset: name of dataset, need to be provided as input for pipeline</span>
</span></span><span class="line"><span class="cl"><span class="c1"># input data_path: path for data storage, need to be provided as input for pipeline</span>
</span></span><span class="line"><span class="cl"><span class="c1"># return: a print function, the printed contents would be reveal in logs.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">download_data</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">data_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># install the necessary libraries</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># as each component would run as a container, you need to import these necessary libraries here inside this function-based component</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">zipfile</span><span class="o">,</span> <span class="nn">pickle</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># again, as each component would run as a container, we use &#39;subprocess.run&#39; here to run command lines while pipeline running</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;-m&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">,</span> <span class="s2">&#34;install&#34;</span><span class="p">,</span> <span class="s2">&#34;--upgrade&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;kaggle&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># import libraries</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># you may directly copy and paste your Kaggle username and key here for convinience</span>
</span></span><span class="line"><span class="cl">    <span class="n">kaggle_user</span> <span class="o">=</span> <span class="s1">&#39;YOUR_KAGGLE_USERNAME&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">kaggle_key</span> <span class="o">=</span> <span class="s1">&#39;YOUR_KAGGLE_KEY&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># or, spend some time setup kaggle environment for data download</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># with open(&#39;/secret/kaggle-secret/password&#39;, &#39;r&#39;) as file:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     kaggle_key = file.read().rstrip()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># with open(&#39;/secret/kaggle-secret/username&#39;, &#39;r&#39;) as file:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#     kaggle_user = file.read().rstrip()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;KAGGLE_USERNAME&#39;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;KAGGLE_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kaggle_user</span><span class="p">,</span> <span class="n">kaggle_key</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># create data_path directory</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># download kaggle&#39;s g-research-crypto-forecasting data</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;kaggle&#34;</span><span class="p">,</span><span class="s2">&#34;competitions&#34;</span><span class="p">,</span> <span class="s2">&#34;download&#34;</span><span class="p">,</span> <span class="s2">&#34;-c&#34;</span><span class="p">,</span> <span class="n">dataset</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># extract &#39;train.csv&#39; and &#39;asset_details.csv&#39; in g-research-crypto-forecasting.zip to data_path</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.zip&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">members</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;train.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;asset_details.csv&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- DATA DOWNLOADED --&#39;</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="load-data">Load Data</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># input data_path: path for data storage, need to be provided as input for pipeline</span>
</span></span><span class="line"><span class="cl"><span class="c1"># return: a print function, the printed contents would be reveal in logs.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># install the necessary libraries</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">pickle</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;-m&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">,</span> <span class="s2">&#34;install&#34;</span><span class="p">,</span> <span class="s2">&#34;--upgrade&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># import libraries</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">TRAIN_CSV</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/train.csv&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ASSET_DETAILS_CSV</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/asset_details.csv&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># read TRAIN_CSV and ASSET_DETAILS_CSV</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">TRAIN_CSV</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_asset_details</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ASSET_DETAILS_CSV</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&#34;Asset_ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2020-01-01 00:00:00&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Save the df_train data as a pickle file to be used by the feature_engineering component.</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/df_train&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># Save the df_train data as a pickle file to be used by the merge_data component.</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/df_asset_details&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">df_asset_details</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- DATA LOADED --&#39;</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="feature-engineering">Feature Engineering</h4>
<p>Codes for this step follows most from original model itself (so don&rsquo;t freak out when seeing this long cell).</p>
<p>One thing to note here is that this component needs to save the feature engineered data as a pickle file which would be used later by the modeling component. Similar to Example 1, to enable modeling component to access this feature engineered data, we simply need to store it in the data path.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># save the feature engineered data as a pickle file to be used by the modeling component.</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/feature_df&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">feature_df</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># input data_path: path for data storage, need to be provided as input for pipeline</span>
</span></span><span class="line"><span class="cl"><span class="c1"># return: a print function, the printed contents would be reveal in logs.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># install the necessary libraries</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">subprocess</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;-m&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">,</span> <span class="s2">&#34;install&#34;</span><span class="p">,</span> <span class="s2">&#34;--upgrade&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;tqdm&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;talib-binary&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># import Library</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">talib</span><span class="o">,</span> <span class="nn">datetime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># loading the df_train data</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/df_train&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_train</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># creating technical indicators</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a function to calculate the Relative Strength Index</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">talib</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a function to calculate the Average True Range</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">ATR</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">talib</span><span class="o">.</span><span class="n">ATR</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;High&#34;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">Low</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a function to calculate the Double Exponential Moving Average (DEMA)</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">DEMA</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">time_period</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#Calculate the Exponential Moving Average for some time_period (in days)</span>
</span></span><span class="line"><span class="cl">        <span class="n">EMA</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#Calculate the DEMA</span>
</span></span><span class="line"><span class="cl">        <span class="n">DEMA</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">EMA</span> <span class="o">-</span> <span class="n">EMA</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="n">time_period</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">DEMA</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a function to calculate the upper_shadow</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">upper_shadow</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create a function to calculate the lower_shadow</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">lower_shadow</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_features</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">asset_id</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        This function takes a dataframe with all asset data and return the lagged features for a single asset.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        df - Full dataframe with all assets included
</span></span></span><span class="line"><span class="cl"><span class="s1">        asset_id - integer from 0-13 inclusive to represent a cryptocurrency asset
</span></span></span><span class="line"><span class="cl"><span class="s1">        train - True - you are training your model
</span></span></span><span class="line"><span class="cl"><span class="s1">              - False - you are submitting your model via api
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># filter based on asset id</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Asset_ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">asset_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># sort based on time stamp</span>
</span></span><span class="line"><span class="cl">        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">train</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># define a train_flg column to split your data into train and validation</span>
</span></span><span class="line"><span class="cl">            <span class="n">totimestamp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&#34;</span><span class="si">%d</span><span class="s2">/%m/%Y&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">            <span class="n">valid_window</span> <span class="o">=</span> <span class="p">[</span><span class="n">totimestamp</span><span class="p">(</span><span class="s2">&#34;01/05/2021&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;train_flg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">valid_window</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span> <span class="o">=</span> <span class="n">df_feat</span><span class="p">[[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;Asset_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">,</span> <span class="s1">&#39;Volume&#39;</span><span class="p">,</span><span class="s1">&#39;Target&#39;</span><span class="p">,</span><span class="s1">&#39;train_flg&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;row_id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Asset_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">,</span> <span class="s1">&#39;Volume&#39;</span><span class="p">,</span><span class="s1">&#39;row_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">([</span><span class="mi">30</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">240</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Applyin technical indicators</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;RSI_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RSI</span><span class="p">(</span><span class="n">df_feat</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ATR_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ATR</span><span class="p">(</span><span class="n">df_feat</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;DEMA_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEMA</span><span class="p">(</span><span class="n">df_feat</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">([</span><span class="mi">30</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">240</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># creating lag features</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;sma_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="n">df_feat</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;return_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># new features</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;HL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;OC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Applyin lower_shadow and upper_shadow indicators</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;lower_shadow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lower_shadow</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;upper_shadow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">upper_shadow</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># replace inf with nan</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># datetime features</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s2">&#34;dayofyear&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s2">&#34;weekofyear&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekofyear</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span><span class="p">[</span><span class="s2">&#34;season&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_feat</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">%</span><span class="mi">12</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># drop features</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span> <span class="o">=</span> <span class="n">df_feat</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span><span class="s1">&#39;Close&#39;</span><span class="p">,</span><span class="s1">&#39;High&#39;</span><span class="p">,</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># fill nan values with 0</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_feat</span> <span class="o">=</span> <span class="n">df_feat</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df_feat</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># create your features dataframe for each asset and concatenate</span>
</span></span><span class="line"><span class="cl">    <span class="n">feature_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">feature_df</span><span class="p">,</span><span class="n">get_features</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">    <span class="c1"># save the feature engineered data as a pickle file to be used by the modeling component.</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/feature_df&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">feature_df</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- FEATURE ENGINEERING FINISHED --&#39;</span><span class="p">))</span> 
</span></span></code></pre></div><h4 id="merge-assets-features">Merge Assets Features</h4>
<p>This component needs to access the featured data generated in above Feature Engineering component. That data is stored in the data path we specified.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/feature_df&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># input data_path: path for data storage, need to be provided as input for pipeline</span>
</span></span><span class="line"><span class="cl"><span class="c1"># return: a print function, the printed contents would be reveal in logs.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">merge_assets_features</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># install the necessary libraries</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">subprocess</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;-m&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">,</span> <span class="s2">&#34;install&#34;</span><span class="p">,</span> <span class="s2">&#34;--upgrade&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># import Library</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">pickle</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#loading the feature_df data</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/feature_df&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1">#loading the df_asset_details data</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/df_asset_details&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">df_asset_details</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># assign weight column feature dataframe</span>
</span></span><span class="line"><span class="cl">    <span class="n">feature_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">feature_df</span><span class="p">,</span> <span class="n">df_asset_details</span><span class="p">[[</span><span class="s1">&#39;Asset_ID&#39;</span><span class="p">,</span><span class="s1">&#39;Weight&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Asset_ID&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#Save the feature_df as a pickle file to be used by the modelling component.</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/merge_feature_df&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">feature_df</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- ASSETS FEATURES MERGED --&#39;</span><span class="p">))</span>  
</span></span></code></pre></div><h4 id="modeling">Modeling</h4>
<p>Again, the overall logic comes completely from the original ML model. Things we need to note here, for our pipeline lab, is, again, the location of data storage.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># input data_path: path for data storage, need to be provided as input for pipeline</span>
</span></span><span class="line"><span class="cl"><span class="c1"># return: a print function, the printed contents would be reveal in logs.</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">modeling</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># install the necessary libraries</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">subprocess</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;-m&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">,</span> <span class="s2">&#34;install&#34;</span><span class="p">,</span> <span class="s2">&#34;--upgrade&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;lightgbm&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># import Library</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">joblib</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMRegressor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#loading the new_feats data</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/merge_feature_df&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1"># define features for LGBM</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Asset_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;RSI_30&#39;</span><span class="p">,</span> <span class="s1">&#39;ATR_30&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;DEMA_30&#39;</span><span class="p">,</span> <span class="s1">&#39;RSI_120&#39;</span><span class="p">,</span> <span class="s1">&#39;ATR_120&#39;</span><span class="p">,</span> <span class="s1">&#39;DEMA_120&#39;</span><span class="p">,</span> <span class="s1">&#39;RSI_240&#39;</span><span class="p">,</span> <span class="s1">&#39;ATR_240&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;DEMA_240&#39;</span><span class="p">,</span> <span class="s1">&#39;sma_30&#39;</span><span class="p">,</span> <span class="s1">&#39;return_30&#39;</span><span class="p">,</span> <span class="s1">&#39;sma_120&#39;</span><span class="p">,</span> <span class="s1">&#39;return_120&#39;</span><span class="p">,</span> <span class="s1">&#39;sma_240&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;return_240&#39;</span><span class="p">,</span> <span class="s1">&#39;HL&#39;</span><span class="p">,</span> <span class="s1">&#39;OC&#39;</span><span class="p">,</span> <span class="s1">&#39;lower_shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;upper_shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s1">&#39;dayofyear&#39;</span><span class="p">,</span> <span class="s1">&#39;weekofyear&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">categoricals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Asset_ID&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># define the evaluation metric</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">weighted_correlation</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">train_data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">weights</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">add_w</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">sum_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">mean_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">sum_w</span>
</span></span><span class="line"><span class="cl">        <span class="n">mean_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">sum_w</span>
</span></span><span class="line"><span class="cl">        <span class="n">var_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">mean_a</span><span class="p">))</span> <span class="o">/</span> <span class="n">sum_w</span>
</span></span><span class="line"><span class="cl">        <span class="n">var_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">mean_b</span><span class="p">))</span> <span class="o">/</span> <span class="n">sum_w</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">w</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">-</span> <span class="n">mean_a</span> <span class="o">*</span> <span class="n">mean_b</span>
</span></span><span class="line"><span class="cl">        <span class="n">corr</span> <span class="o">=</span> <span class="n">cov</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_a</span> <span class="o">*</span> <span class="n">var_b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;eval_wcorr&#39;</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># define train and validation weights and datasets</span>
</span></span><span class="line"><span class="cl">    <span class="n">weights_train</span> <span class="o">=</span> <span class="n">feature_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;train_flg == 1&#39;</span><span class="p">)[[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">weights_test</span> <span class="o">=</span> <span class="n">feature_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;train_flg == 0&#39;</span><span class="p">)[[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">feature_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;train_flg == 1&#39;</span><span class="p">)[</span><span class="n">features</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                                <span class="n">feature_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;train_flg == 1&#39;</span><span class="p">)[</span><span class="s1">&#39;Target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                <span class="n">feature_name</span> <span class="o">=</span> <span class="n">features</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="n">categorical_feature</span><span class="o">=</span> <span class="n">categoricals</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">val_dataset</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">feature_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;train_flg == 0&#39;</span><span class="p">)[</span><span class="n">features</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                              <span class="n">feature_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;train_flg == 0&#39;</span><span class="p">)[</span><span class="s1">&#39;Target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                              <span class="n">feature_name</span> <span class="o">=</span> <span class="n">features</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                             <span class="n">categorical_feature</span><span class="o">=</span> <span class="n">categoricals</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># add weights</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_dataset</span><span class="o">.</span><span class="n">add_w</span> <span class="o">=</span> <span class="n">weights_train</span>
</span></span><span class="line"><span class="cl">    <span class="n">val_dataset</span><span class="o">.</span><span class="n">add_w</span> <span class="o">=</span> <span class="n">weights_test</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># LGBM params</span>
</span></span><span class="line"><span class="cl">    <span class="n">evals_result</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;regression&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;rmse&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;boosting_type&#39;</span><span class="p">:</span> <span class="s1">&#39;gbdt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">2022</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># train LGBM</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">train_set</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                      <span class="n">valid_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">val_dataset</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                      <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">verbose_eval</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">feval</span><span class="o">=</span><span class="n">weighted_correlation</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">evals_result</span> <span class="o">=</span> <span class="n">evals_result</span> 
</span></span><span class="line"><span class="cl">                     <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># saving model</span>
</span></span><span class="line"><span class="cl">    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/lgb.jl&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- MODELED --&#39;</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="evaluate">Evaluate</h4>
<p>This component would return the evaluation metrics, which would be reveal in Input/Output, Output artifacts on Kubeflow UI after pipeline finishes running. More details on this would be discussed later in pipeline running section.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># input data_path: path for data storage, need to be provided as input for pipeline</span>
</span></span><span class="line"><span class="cl"><span class="c1"># input metric_path: path to store evaluation metric</span>
</span></span><span class="line"><span class="cl"><span class="c1"># return the evaluation metrics, which would be reveal in Input/Output, Output artifacts</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">evaluation_result</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">metrics_path</span><span class="p">:</span> <span class="n">OutputPath</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s2">&#34;EvaluationOutput&#34;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&#34;mlpipeline_metrics&#34;</span><span class="p">,</span> <span class="s2">&#34;Metrics&#34;</span><span class="p">)]):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># import Library</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">subprocess</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;-m&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">,</span> <span class="s2">&#34;install&#34;</span><span class="p">,</span> <span class="s2">&#34;--upgrade&#34;</span><span class="p">,</span> <span class="s2">&#34;pip&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span><span class="s1">&#39;lightgbm&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">json</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">joblib</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMRegressor</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># load model</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/lgb.jl&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># model evaluation</span>
</span></span><span class="line"><span class="cl">    <span class="n">root_mean_squared_error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">best_score</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;valid_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rmse&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">weighted_correlation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">best_score</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;valid_0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;eval_wcorr&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># create kubeflow metric metadata for UI    </span>
</span></span><span class="line"><span class="cl">    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;root-mean-squared-error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="n">root_mean_squared_error</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;RAW&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;weighted-correlation&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;numberValue&#39;</span><span class="p">:</span>  <span class="n">weighted_correlation</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;RAW&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                            <span class="p">]</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">metrics_path</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">output_tuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&#34;EvaluationOutput&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;mlpipeline_metrics&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">output_tuple</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metrics</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="create-pipeline-components">Create Pipeline Components</h3>
<p>In this example, we use <code>kfp.components.create_component_from_func</code> to return a factory function that we would use to create pipeline steps.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">download_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span><span class="n">download_data</span><span class="p">,</span><span class="n">base_image</span><span class="o">=</span><span class="s2">&#34;python:3.7.1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">load_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span><span class="n">load_data</span><span class="p">,</span><span class="n">base_image</span><span class="o">=</span><span class="s2">&#34;python:3.7.1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">merge_assets_features_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span><span class="n">merge_assets_features</span><span class="p">,</span><span class="n">base_image</span><span class="o">=</span><span class="s2">&#34;python:3.7.1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">feature_eng_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span><span class="n">feature_engineering</span><span class="p">,</span><span class="n">base_image</span><span class="o">=</span><span class="s2">&#34;python:3.7.1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">modeling_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span><span class="n">modeling</span><span class="p">,</span> <span class="n">base_image</span><span class="o">=</span><span class="s2">&#34;python:3.7.1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">evaluation_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">create_component_from_func</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">,</span> <span class="n">base_image</span><span class="o">=</span><span class="s2">&#34;python:3.7.1&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="build-pipeline">Build Pipeline</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># define pipeline</span>
</span></span><span class="line"><span class="cl"><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;g-research-crypto-forecasting-pipeline&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">              <span class="n">description</span><span class="o">=</span><span class="s2">&#34;g-research-crypto-forecasting-pipeline&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define parameters to be fed into pipeline</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">g_research_crypto_forecast_pipeline</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                             <span class="n">dataset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="c1"># name of dataset, zip</span>
</span></span><span class="line"><span class="cl">                             <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="c1"># path for data storage, would be used through entire pipeline, all components</span>
</span></span><span class="line"><span class="cl">                            <span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Define volume to share data between components.</span>
</span></span><span class="line"><span class="cl">    <span class="n">vop</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">VolumeOp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;create_data_volume&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">resource_name</span><span class="o">=</span><span class="s2">&#34;data-volume&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">size</span><span class="o">=</span><span class="s2">&#34;16Gi&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">modes</span><span class="o">=</span><span class="n">dsl</span><span class="o">.</span><span class="n">VOLUME_MODE_RWO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create download container, using ops we defined in above code cell</span>
</span></span><span class="line"><span class="cl">    <span class="n">download_container</span> <span class="o">=</span> <span class="n">download_op</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>\
</span></span><span class="line"><span class="cl">                        <span class="o">.</span><span class="n">add_pvolumes</span><span class="p">({</span><span class="n">data_path</span><span class="p">:</span> <span class="n">vop</span><span class="o">.</span><span class="n">volume</span><span class="p">})</span> <span class="c1"># add pvolumes, and mount it to data_path for data sharing among steps</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create load container.</span>
</span></span><span class="line"><span class="cl">    <span class="n">load_container</span> <span class="o">=</span> <span class="n">load_op</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>\
</span></span><span class="line"><span class="cl">                    <span class="o">.</span><span class="n">add_pvolumes</span><span class="p">({</span><span class="n">data_path</span><span class="p">:</span> <span class="n">download_container</span><span class="o">.</span><span class="n">pvolume</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create feature engineering container.</span>
</span></span><span class="line"><span class="cl">    <span class="n">feat_eng_container</span> <span class="o">=</span> <span class="n">feature_eng_op</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>\
</span></span><span class="line"><span class="cl">                            <span class="o">.</span><span class="n">add_pvolumes</span><span class="p">({</span><span class="n">data_path</span><span class="p">:</span> <span class="n">load_container</span><span class="o">.</span><span class="n">pvolume</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create merge_assets_feat container.</span>
</span></span><span class="line"><span class="cl">    <span class="n">merge_assets_feat_container</span> <span class="o">=</span> <span class="n">merge_assets_features_op</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>\
</span></span><span class="line"><span class="cl">                                 <span class="o">.</span><span class="n">add_pvolumes</span><span class="p">({</span><span class="n">data_path</span><span class="p">:</span> <span class="n">feat_eng_container</span><span class="o">.</span><span class="n">pvolume</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create modeling container.</span>
</span></span><span class="line"><span class="cl">    <span class="n">modeling_container</span> <span class="o">=</span> <span class="n">modeling_op</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>\
</span></span><span class="line"><span class="cl">                        <span class="o">.</span><span class="n">add_pvolumes</span><span class="p">({</span><span class="n">data_path</span><span class="p">:</span> <span class="n">merge_assets_feat_container</span><span class="o">.</span><span class="n">pvolume</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create prediction container.</span>
</span></span><span class="line"><span class="cl">    <span class="n">evaluation_container</span> <span class="o">=</span> <span class="n">evaluation_op</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span><span class="o">.</span><span class="n">add_pvolumes</span><span class="p">({</span><span class="n">data_path</span><span class="p">:</span> <span class="n">modeling_container</span><span class="o">.</span><span class="n">pvolume</span><span class="p">})</span>
</span></span></code></pre></div><p>Similar to Example 1, compile our difined pipeline into a YAML file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kfp</span><span class="o">.</span><span class="n">compiler</span><span class="o">.</span><span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">pipeline_func</span><span class="o">=</span><span class="n">g_research_crypto_forecast_pipeline</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">package_path</span><span class="o">=</span><span class="s1">&#39;pipeline_gResearch.yaml&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>You should then be able to see a file called <code>pipeline_gResearch.yaml</code> in your current directory.</p>
<h3 id="run-pipeline">Run Pipeline</h3>
<p>Again, we provide you with a compiled pipeline YAML file <code>gResearch_pipeline_test.yaml</code>. Feel free to use it.</p>
<p>Similar to Example 1, download <code>pipeline_gResearch.yaml</code>, and upload it to Pipelines on Kubeflow UI.</p>
<p><img src="./img/g1.png" alt="g1"></p>
<p><img src="./img/g2.png" alt="g2"></p>
<p><img src="./img/g3.png" alt="g3"></p>
<p>This pipeline graph is more complex than the one in Example 1. You may take some time going through it.</p>
<p>Again, create an experiment for this pipeline, and create a run. This time, you need to provide two inputs, <code>dataset</code> and <code>data_path</code>, exactly the ones for our first step Data Download. If you do not intend to make any personalization on datasets and data path, enter following values</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># arguments</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;&#34; not needed while inputting them</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset</span> <span class="o">=</span> <span class="s2">&#34;g-research-crypto-forecasting&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data_path</span> <span class="o">=</span> <span class="s2">&#34;/mnt&#34;</span>
</span></span></code></pre></div><p><img src="./img/g4.png" alt="g4"></p>
<p><img src="./img/g5.png" alt="g5"></p>
<p>The pipeline would start to run then. You would be able to see the running process in Runs Page on Kubeflow UI.</p>
<p><img src="./img/g6.png" alt="g6"></p>
<p>The pipeline running may take some time, as the datasets is pretty big and there are much more steps in this example. There would be a green symbol appears next to each component after its completion. And you can always click on each component to see its details, such as its input/output, volumes, logs, and pod.</p>
<p><img src="./img/g7.png" alt="g7"></p>
<p>After the whole pipeline finishes running, click on any of the component/step that you are interested in. You should be able to see main-logs under Input/Output, Output artifacts.</p>
<p>Specifically, click on Evaluation Result Step, you should see &ldquo;metrics&rdquo; under Input/Output, Output artifacts. Click into them to see the evaluation metrics.</p>
<p>We also provide you with example logs of evaluation metrics in <a href="./logs/">logs</a> folder.</p>
<h2 id="troubleshooting">Troubleshooting</h2>

	
	
	<div class="text-muted mt-5 pt-3 border-top">
  Last modified November 2, 2022: <a href="https://github.com/vmware/ml-ops-platform-for-vsphere//commit/ea33ff7e3eaa88a7b3afec9d81b5e40846d0e212">add Kubeflow on vSphere website (ea33ff7)</a>
</div>

</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Copyright VMware, Inc.</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/ml-ops-platform-for-vsphere/js/tabpane-persist.js'></script>


















<script src="/ml-ops-platform-for-vsphere/js/main.min.996daafaf2da35aed251c4a4417605fd236f955837f403643c6117bf904daa5f.js" integrity="sha256-mW2q&#43;vLaNa7SUcSkQXYF/SNvlVg39ANkPGEXv5BNql8=" crossorigin="anonymous"></script>




<script src="/ml-ops-platform-for-vsphere/js/copy-code-button.min.js"></script>




  </body>
</html>